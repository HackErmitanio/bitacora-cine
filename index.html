<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Escena 24</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f0c29;
  --bg2:#302b63;
  --bg3:#24243e;
  --card:#1b1b3a;
  --accent:#ff4ecd;
  --accent2:#00f5d4;
  --text:#ffffff;
}

body{
  margin:0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(120deg,var(--bg),var(--bg2),var(--bg3));
  color:var(--text);
  overflow-x:hidden;
}

header{
  padding:50px 20px 20px 20px;
  text-align:center;
  overflow:hidden;
}

#titulo{
  margin:0;
  font-family: 'Cinzel', serif;
  font-size:4rem;
  background: linear-gradient(90deg,#ff4ecd,#00f5d4,#ff4ecd);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  animation:neon 2s infinite alternate;
  transition: transform 0.3s, font-size 0.3s, filter 0.3s;
}

.header-subtitle{
  margin-top:10px;
  font-size:1.3rem;
  opacity:0.85;
}

@keyframes neon{
  0%{filter: drop-shadow(0 0 5px #ff4ecd);}
  50%{filter: drop-shadow(0 0 15px #00f5d4);}
  100%{filter: drop-shadow(0 0 25px #ff4ecd);}
}

nav{
  margin:20px 0;
  display:flex;
  justify-content:center;
  gap:15px;
  flex-wrap:wrap;
}

nav a{
  background:var(--card);
  padding:12px 22px;
  border-radius:30px;
  text-decoration:none;
  color:white;
  font-weight:bold;
  transition:.3s;
}

nav a:hover{
  background:var(--accent);
}

.search-box{
  margin-top:15px;
}

.search-box input{
  width:90%;
  max-width:500px;
  padding:14px;
  border-radius:30px;
  border:none;
  font-size:16px;
  outline:none;
}

main{
  padding:20px;
}

h2{
  margin-bottom:20px;
  color:var(--accent2);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:22px;
}

.card{
  background:var(--card);
  border-radius:16px;
  padding:10px;
  text-align:center;
  cursor:pointer;
  opacity:0;
  transform:translateY(20px);
  transition:.5s;
}

.card img{
  width:100%;
  border-radius:12px;
  transition: transform .3s, box-shadow .3s;
}

.card:hover img{
  transform:scale(1.05);
  box-shadow:0 15px 25px rgba(255,77,237,.7);
}

.card span{
  display:block;
  margin-top:8px;
  font-size:.9rem;
}

.modal{
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.95);
  color:white;
  overflow:auto;
  padding:50px 20px;
  z-index:1000;
}

.modal.show{
  display:block;
}

.modal-content{
  max-width:900px;
  margin:auto;
}

.modal-header{
  display:flex;
  flex-wrap:wrap;
  gap:20px;
}

.modal-header img{
  width:300px;
  border-radius:18px;
}

.modal-info{
  flex:1;
}

.badge{
  display:inline-block;
  background:var(--accent);
  padding:5px 12px;
  border-radius:20px;
  margin-right:8px;
  font-size:.8rem;
}

.stars span{
  font-size:30px;
  cursor:pointer;
  color:#555;
}

.stars span.active{
  color:gold;
}

textarea{
  width:100%;
  min-height:100px;
  border-radius:12px;
  border:none;
  padding:12px;
  font-size:15px;
}

.recommend label{
  display:block;
  margin-top:8px;
}

button{
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  border:none;
  padding:12px 20px;
  border-radius:30px;
  color:black;
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
}

.close-btn{
  float:right;
  font-size:30px;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <h1 id="titulo">ESCENA 24</h1>
  <div class="header-subtitle">Cine, series, anime y cultura pop</div>

  <nav>
    <a href="#new">Pel√≠culas nuevas</a>
    <a href="#anime">Anime</a>
    <a href="#series">Series</a>
    <a href="#classic">Cl√°sicas</a>
    <a href="#mexico">Cine mexicano</a>
  </nav>

  <div class="search-box">
    <input id="search" placeholder="Buscar pel√≠culas o series...">
  </div>
</header>

<main id="app"></main>

<div class="modal" id="modal">
  <div class="modal-content" id="modal-content"></div>
</div>

<script>
const API_KEY = "5b4ad82505bd1853a5256c1db2d4b330";
const IMG = "https://image.tmdb.org/t/p/w500";
const app = document.getElementById("app");
const modal = document.getElementById("modal");
const modalContent = document.getElementById("modal-content");

window.addEventListener("load", router);
window.addEventListener("hashchange", router);

/* T√çTULO SCROLL */
const titulo = document.getElementById("titulo");
window.addEventListener("scroll", ()=>{
  let y = window.scrollY;
  let size = Math.max(40, 80 - y*0.1);
  titulo.style.fontSize = size + "px";
  titulo.style.filter = `drop-shadow(0 0 ${5 + y*0.1}px #ff4ecd)`;
});

/* B√öSQUEDA GLOBAL */
document.getElementById("search").addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    location.hash = "#search/"+encodeURIComponent(e.target.value);
  }
});

/* ROUTER */
function router(){
  const h = location.hash;
  if(h.startsWith("#movie/") || h.startsWith("#tv/")){
    const [t,id] = h.replace("#","").split("/");
    detalleModal(t,id);
  }else if(h.startsWith("#search/")){
    buscar(decodeURIComponent(h.split("/")[1]));
  }else{
    catalogo(h.replace("#","") || "new");
  }
}

function buscar(q){
  app.innerHTML = `<h2>üîé Resultados para "${q}"</h2><div class="grid" id="grid"></div>`;
  fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&language=es-MX&query=${q}&page=1`)
    .then(r=>r.json())
    .then(d=>{
      const g = document.getElementById("grid");
      d.results.forEach((i,index)=>{
        if(!i.poster_path) return;
        const c=document.createElement("div");
        c.className="card";
        c.innerHTML=`<img src="${IMG+i.poster_path}"><span>${i.title||i.name}</span>`;
        c.onclick=()=>detalleModal(i.media_type,i.id);
        g.appendChild(c);
        setTimeout(()=>c.classList.add("show"),index*50);
      });
    });
}

let cargando=false;
function catalogo(cat){
  app.innerHTML = `<h2>${tituloCat(cat)}</h2><div class="grid" id="grid"></div>`;
  cargar(cat,1);
  window.onscroll = function(){
    if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500){
      if(!cargando){cargando=true; cargar(cat,window.pageActual+1);}
    }
  }
}

function cargar(cat,page){
  cargando=true;
  window.pageActual=page;
  let url="";
  switch(cat){
    case "new": url=`discover/movie?sort_by=popularity.desc`; break;
    case "classic": url=`discover/movie?primary_release_date.lte=1980&sort_by=popularity.desc`; break;
    case "mexico": url=`discover/movie?with_original_language=es&region=MX&sort_by=popularity.desc`; break;
    case "series": url=`discover/tv?sort_by=popularity.desc`; break;
    case "anime": url=`discover/tv?with_genres=16&with_original_language=ja&sort_by=popularity.desc`; break;
  }
  fetch(`https://api.themoviedb.org/3/${url}&api_key=${API_KEY}&language=es-MX&page=${page}`)
    .then(r=>r.json())
    .then(d=>{
      const g=document.getElementById("grid");
      d.results.forEach((i,index)=>{
        if(!i.poster_path) return;
        const c=document.createElement("div");
        c.className="card";
        c.innerHTML=`<img src="${IMG+i.poster_path}"><span>${i.title||i.name}</span>`;
        c.onclick=()=>detalleModal(cat==="series"||cat==="anime"?"tv":"movie",i.id);
        g.appendChild(c);
        setTimeout(()=>c.classList.add("show"),index*50);
      });
      cargando=false;
    });
}

function tituloCat(c){
  return{
    new:"üé• Pel√≠culas nuevas",
    anime:"üéå Anime",
    series:"üì∫ Series",
    classic:"üéû Cl√°sicos",
    mexico:"üá≤üáΩ Cine mexicano"
  }[c];
}

/* MODAL DETALLE */
function detalleModal(type,id){
  Promise.all([
    fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=es-MX`).then(r=>r.json()),
    fetch(`https://api.themoviedb.org/3/${type}/${id}/credits?api_key=${API_KEY}`).then(r=>r.json())
  ]).then(([d,c])=>{
    const director = c.crew.find(p=>p.job==="Director") || {};
    const mainCast = c.cast.slice(0,5).map(a=>a.name).join(", ");
    modalContent.innerHTML=`
      <span class="close-btn" onclick="cerrarModal()">√ó</span>
      <div class="modal-header">
        <img src="${IMG+d.poster_path}">
        <div class="modal-info">
          <h2>${d.title||d.name}</h2>
          <p>${d.overview||"Sin descripci√≥n."}</p>
          <p>
            <span class="badge">A√±o: ${(d.release_date||d.first_air_date||"").slice(0,4)}</span>
            <span class="badge">Duraci√≥n: ${d.runtime||d.episode_run_time?.[0]||"?"} min</span>
            <span class="badge">Idioma: ${d.original_language.toUpperCase()}</span>
            <span class="badge">Pa√≠s: ${d.production_countries?.map(p=>p.name).join(",")||"?"}</span>
          </p>
          <p><strong>Director / Creador:</strong> ${director.name||"No disponible"}</p>
          <p><strong>G√©neros:</strong> ${d.genres.map(g=>g.name).join(", ")}</p>
          <p><strong>Reparto principal:</strong> ${mainCast}</p>
          <p><strong>Popularidad TMDB:</strong> ${d.popularity}</p>

          <h3>‚≠ê Tu puntuaci√≥n</h3>
          <div class="stars" id="stars"></div>
          <h3>üìù Rese√±a guiada</h3>
          <div class="recommend">
            <label>¬øLa recomendar√≠as? 
              <select id="recommend">
                <option value="">Selecciona</option>
                <option value="S√≠">S√≠</option>
                <option value="No">No</option>
              </select>
            </label>
            <label>¬øPor qu√©?</label>
            <textarea id="review"></textarea>
          </div>
          <button onclick="guardar(${id})">Guardar rese√±a</button>
        </div>
      </div>
    `;
    modal.classList.add("show");
    estrellas(id);
    const rec = localStorage.getItem("recommend_"+id);
    if(rec) document.getElementById("recommend").value=rec;
    document.getElementById("review").value = localStorage.getItem("review_"+id)||"";
  });
}

function cerrarModal(){ modal.classList.remove("show"); }

function estrellas(id){
  const s=document.getElementById("stars");
  s.innerHTML="";
  let r=localStorage.getItem("rating_"+id)||0;
  for(let i=1;i<=5;i++){
    const e=document.createElement("span");
    e.innerText="‚òÖ";
    if(i<=r) e.classList.add("active");
    e.onclick=()=>{localStorage.setItem("rating_"+id,i);estrellas(id);}
    s.appendChild(e);
  }
}

function guardar(id){
  localStorage.setItem("review_"+id,document.getElementById("review").value);
  localStorage.setItem("recommend_"+id,document.getElementById("recommend").value);
  alert("Rese√±a guardada");
}
</script>
</body>
</html>


